import{f as r,o as a,g as t,z as m,q as D,t as h,x,l as p,u as b,r as w,c as L,j as q,k as $,B as z,C as M,F as V,A as B}from"./runtime-dom.esm-bundler-CaHSP4Q1.js";import{a as N,b as O,_ as A}from"./Badge-DSfqQ8Of.js";function H(){var s;return((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}function T(){var s;return((s=document.querySelector('meta[name="superadmin"]'))==null?void 0:s.getAttribute("content"))==="1"}const J={Accept:"application/json"};async function K(){try{const s=await fetch("/api/invitations",{headers:{Accept:"application/json"},credentials:"include"});if(!s.ok)throw new Error("Failed to load invitations");const d=await s.json();let u,v=null;return Array.isArray(d)?u=d:(u=Array.isArray(d.data)?d.data:[],v=d.meta??null),{data:u,meta:v,error:null}}catch(s){return console.error(s),{data:[],meta:null,error:s.message||"Error loading invitations"}}}async function F(s){const d=await fetch(`/api/invitations/${s}`,{method:"DELETE",headers:{...J,"X-CSRF-TOKEN":H()}});if(!d.ok)throw new Error(`Delete failed with status ${d.status}`);return!0}async function X(s=[]){const d=[];for(const u of s)try{await F(u),d.push({id:u,success:!0})}catch(v){console.warn("Bulk delete error for",u,v),d.push({id:u,success:!1})}return d}const G={key:0,class:"border-t last:border-b hover:bg-slate-50/60"},Q={class:"px-4 py-3 align-top w-8"},W=["value","checked"],Y={class:"px-4 py-3 align-top"},Z={class:"font-medium text-slate-900"},_={class:"text-xs text-slate-500"},ee={class:"px-4 py-3 align-top text-xs text-slate-600"},te={class:"px-4 py-3 align-top text-xs text-slate-600"},se={class:"px-4 py-3 align-top text-xs text-slate-600"},le={key:0},ie={key:1},ne={class:"px-4 py-3 align-top text-xs"},oe={class:"px-4 py-3 align-top text-xs"},ae={key:0},de={class:"max-w-[200px] truncate text-slate-600"},re={key:1,class:"text-red-500 text-sm"},ue={class:"px-4 py-3 align-top text-right text-xs"},me={class:"flex flex-wrap justify-end gap-2"},ce={key:1,class:"rounded-2xl border border-slate-200 bg-white p-3 shadow-sm"},pe={class:"flex items-start justify-between gap-2"},ve={class:"flex items-center gap-2"},fe=["value","checked"],xe={class:"font-medium text-slate-900 text-sm"},be={class:"mt-0.5 text-[11px] text-slate-500"},ye={class:"mt-2 grid grid-cols-2 gap-1 text-[11px] text-slate-600"},ge={class:"mt-3 flex flex-wrap gap-2 text-[11px]"},R={__name:"InvitationItem",props:{item:Object,mode:String,selected:Boolean},setup(s){const d=s,u=T(),v=`${window.location.origin}/i/${d.item.slug}`,y=l=>new Date(l).toLocaleDateString("ru-RU");return(l,i)=>{var C,f,S,k;return s.mode==="desktop"?(a(),r("tr",G,[t("td",Q,[t("input",{type:"checkbox",value:s.item.id,checked:s.selected,onChange:i[0]||(i[0]=c=>l.$emit("select",s.item.id,c))},null,40,W)]),t("td",Y,[t("div",Z,m(s.item.bride_name)+" & "+m(s.item.groom_name),1),t("div",_,m(s.item.title||"—"),1)]),t("td",ee,m(((C=s.item.template)==null?void 0:C.name)||"—"),1),t("td",te,m(((f=s.item.user)==null?void 0:f.name)||"Superadmin only"),1),t("td",se,[s.item.date?(a(),r("span",le,m(y(s.item.date)),1)):(a(),r("span",ie,"—"))]),t("td",ne,[D(N,{type:s.item.is_published?"success":"gray"},{default:h(()=>[x(m(s.item.is_published?"Published":"Draft"),1)]),_:1},8,["type"])]),t("td",oe,[s.item.is_published?(a(),r("div",ae,[t("div",de,m(s.item.slug),1),t("button",{class:"mt-1 text-[11px] text-rose-500 hover:text-rose-600",type:"button",onClick:i[1]||(i[1]=c=>l.$emit("copy",s.item))}," Copy link ")])):(a(),r("div",re,"-"))]),t("td",ue,[t("div",me,[b(u)?(a(),r("a",{key:0,href:v,target:"_blank",class:"rounded-full border border-slate-200 px-3 py-1 font-medium hover:bg-slate-50"}," Open ")):p("",!0),b(u)?(a(),r("button",{key:1,class:"rounded-full bg-slate-900 px-3 py-1 font-medium text-white hover:bg-slate-800",onClick:i[2]||(i[2]=c=>l.$emit("edit",s.item))}," Edit ")):p("",!0),t("button",{class:"rounded-full border border-leaf-soft px-3 py-1 font-medium text-leaf-deep hover:bg-leaf-soft/20",onClick:i[3]||(i[3]=c=>l.$emit("rsvp",s.item))}," RSVP "),b(u)?(a(),r("button",{key:2,class:"rounded-full bg-red-500 px-3 py-1 font-medium text-white hover:bg-red-600",onClick:i[4]||(i[4]=c=>l.$emit("delete",s.item))}," Delete ")):p("",!0)])])])):(a(),r("div",ce,[t("div",pe,[t("div",null,[t("div",ve,[t("input",{type:"checkbox",value:s.item.id,checked:s.selected,onChange:i[5]||(i[5]=c=>l.$emit("select",s.item.id,c))},null,40,fe),t("div",xe,m(s.item.bride_name)+" & "+m(s.item.groom_name),1)]),t("div",be,m(s.item.title||"—"),1)]),D(N,{type:s.item.is_published?"success":"gray"},{default:h(()=>[x(m(s.item.is_published?"Published":"Draft"),1)]),_:1},8,["type"])]),t("div",ye,[t("div",null,[i[10]||(i[10]=t("span",{class:"font-semibold"},"Template:",-1)),x(" "+m(((S=s.item.template)==null?void 0:S.name)||"—"),1)]),t("div",null,[i[11]||(i[11]=t("span",{class:"font-semibold"},"Owner:",-1)),x(" "+m(((k=s.item.user)==null?void 0:k.name)||"—"),1)]),t("div",null,[i[12]||(i[12]=t("span",{class:"font-semibold"},"Date:",-1)),x(" "+m(s.item.date?y(s.item.date):"—"),1)]),t("div",null,[i[13]||(i[13]=t("span",{class:"font-semibold"},"Link:",-1)),x(" "+m(s.item.is_published?s.item.slug:"-"),1)])]),t("div",ge,[s.item.is_published?(a(),r("button",{key:0,class:"rounded-full border border-rose-200 px-3 py-1 text-rose-500 hover:bg-rose-50",onClick:i[6]||(i[6]=c=>l.$emit("copy",s.item))}," Copy link ")):p("",!0),b(u)?(a(),r("a",{key:1,href:v,target:"_blank",class:"rounded-full border border-slate-200 px-3 py-1 font-medium text-slate-800 hover:bg-slate-50"}," Open ")):p("",!0),b(u)?(a(),r("button",{key:2,class:"rounded-full bg-slate-900 px-3 py-1 font-medium text-white hover:bg-slate-800",onClick:i[7]||(i[7]=c=>l.$emit("edit",s.item))}," Edit ")):p("",!0),t("button",{class:"rounded-full border border-leaf-soft px-3 py-1 font-medium text-leaf-deep hover:bg-leaf-soft/20",onClick:i[8]||(i[8]=c=>l.$emit("rsvp",s.item))}," RSVP "),b(u)?(a(),r("button",{key:3,class:"ml-auto rounded-full bg-red-500 px-3 py-1 font-medium text-white hover:bg-red-600",onClick:i[9]||(i[9]=c=>l.$emit("delete",s.item))}," Delete ")):p("",!0)])]))}}},he={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ke={class:"flex flex-wrap items-center gap-2"},we={key:2},$e={class:"min-w-full text-left text-sm"},Ce={class:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500"},Se={class:"w-8 px-4 py-3"},Ae=["checked"],De={class:"mt-3 space-y-3 md:hidden"},Ee={class:"flex items-center justify-between text-xs text-slate-600"},Ie={class:"flex items-center gap-2"},je=["checked"],Le={key:0},Ve={key:3,class:"mt-3 text-xs text-red-500"},Oe={__name:"InvitationsListView",setup(s){const d=w([]),u=w(!0),v=w(""),y=w("all"),l=w([]),i=w(T()),C=i,f=L(()=>(Array.isArray(d.value)?d.value:[]).filter(e=>y.value==="published"?!!e.is_published:y.value==="draft"?!e.is_published:!0)),S=L(()=>f.value.length?f.value.every(o=>l.value.includes(o.id)):!1),k=o=>`${window.location.origin}/i/${o.slug}`,c=async o=>{const e=k(o);try{await navigator.clipboard.writeText(e),alert("Link copied!")}catch{prompt("Copy this link:",e)}},P=async()=>{u.value=!0,v.value="";const{data:o,meta:e,error:n}=await K();n?d.value=[]:d.value=o,u.value=!1},E=async o=>{if(confirm(`Удалить приглашение для пары "${o.bride_name} & ${o.groom_name}"?`))try{await F(o.id),d.value=d.value.filter(n=>n.id!==o.id),l.value=l.value.filter(n=>n!==o.id),alert("Invitation deleted")}catch(n){console.error(n),alert("Failed to delete invitation")}},I=(o,e)=>{e.target.checked?l.value.includes(o)||l.value.push(o):l.value=l.value.filter(n=>n!==o)},j=o=>{if(o.target.checked){const e=f.value.map(n=>n.id);l.value=Array.from(new Set([...l.value,...e]))}else{const e=f.value.map(n=>n.id);l.value=l.value.filter(n=>!e.includes(n))}},U=async()=>{!l.value.length||!confirm(`Удалить выбранные приглашения (${l.value.length} шт.)?`)||(await X(l.value),d.value=d.value.filter(e=>!l.value.includes(e.id)),l.value=[],alert("Selected invitations deleted"))};return q(P),(o,e)=>(a(),r("section",null,[t("div",he,[e[10]||(e[10]=t("div",null,[t("h1",{class:"text-xl sm:text-2xl font-semibold"},"My invitations"),t("p",{class:"mt-1 text-xs sm:text-sm text-slate-600"}," Здесь отображаются все созданные приглашения с публичными ссылками. ")],-1)),t("div",ke,[i.value?z((a(),r("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),class:"rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-700"},[...e[8]||(e[8]=[t("option",{value:"all"},"Все",-1),t("option",{value:"published"},"Только published",-1),t("option",{value:"draft"},"Только draft",-1)])],512)),[[M,y.value]]):p("",!0),i.value&&l.value.length?(a(),$(O,{key:1,type:"button",variant:"danger",size:"xs",class:"rounded-full px-3 py-1 text-xs",onClick:U},{default:h(()=>[x(" Delete selected ("+m(l.value.length)+") ",1)]),_:1})):p("",!0),i.value?(a(),$(O,{key:2,variant:"primary",size:"xs",class:"btn-primary text-xs",onClick:e[1]||(e[1]=n=>o.$router.push({name:"templates.index"}))},{default:h(()=>[...e[9]||(e[9]=[x(" + New invitation ",-1)])]),_:1})):p("",!0)])]),u.value?(a(),$(A,{key:0,class:"rounded-2xl border bg-white p-4 text-sm text-slate-500 shadow-sm"},{default:h(()=>[...e[11]||(e[11]=[x(" Loading invitations... ",-1)])]),_:1})):f.value.length?(a(),r("div",we,[D(A,{class:"hidden overflow-hidden rounded-2xl border bg-white p-0 shadow-sm md:block"},{default:h(()=>[t("table",$e,[t("thead",Ce,[t("tr",null,[t("th",Se,[t("input",{type:"checkbox",checked:S.value,onChange:e[2]||(e[2]=n=>j(n))},null,40,Ae)]),e[13]||(e[13]=t("th",{class:"px-4 py-3"},"Couple",-1)),e[14]||(e[14]=t("th",{class:"px-4 py-3"},"Template",-1)),e[15]||(e[15]=t("th",{class:"px-4 py-3"},"Owner",-1)),e[16]||(e[16]=t("th",{class:"px-4 py-3"},"Date",-1)),e[17]||(e[17]=t("th",{class:"px-4 py-3"},"Published",-1)),e[18]||(e[18]=t("th",{class:"px-4 py-3"},"Link",-1)),e[19]||(e[19]=t("th",{class:"px-4 py-3 text-right"},"Actions",-1))])]),t("tbody",null,[(a(!0),r(V,null,B(f.value,n=>(a(),$(R,{key:n.id,item:n,mode:"desktop",selected:l.value.includes(n.id),"is-super-admin":b(C),"public-url":k(n),onSelect:I,onCopy:c,onEdit:e[3]||(e[3]=g=>o.$router.push({name:"invitations.edit",params:{id:g.id}})),onRsvp:e[4]||(e[4]=g=>o.$router.push({name:"invitations.rsvps",params:{id:g.id}})),onDelete:E},null,8,["item","selected","is-super-admin","public-url"]))),128))])])]),_:1}),t("div",De,[t("div",Ee,[t("label",Ie,[t("input",{type:"checkbox",checked:S.value,onChange:e[5]||(e[5]=n=>j(n))},null,40,je),e[20]||(e[20]=t("span",null,"Выбрать все",-1))]),l.value.length?(a(),r("span",Le," Выбрано: "+m(l.value.length),1)):p("",!0)]),(a(!0),r(V,null,B(f.value,n=>(a(),$(R,{key:n.id,item:n,mode:"mobile",selected:l.value.includes(n.id),"is-super-admin":b(C),"public-url":k(n),onSelect:I,onCopy:c,onEdit:e[6]||(e[6]=g=>o.$router.push({name:"invitations.edit",params:{id:g.id}})),onRsvp:e[7]||(e[7]=g=>o.$router.push({name:"invitations.rsvps",params:{id:g.id}})),onDelete:E},null,8,["item","selected","is-super-admin","public-url"]))),128))])])):(a(),$(A,{key:1,class:"rounded-2xl border bg-white p-4 text-sm text-slate-500 shadow-sm"},{default:h(()=>[...e[12]||(e[12]=[x(" Пока нет ни одного приглашения. ",-1)])]),_:1})),v.value?(a(),r("p",Ve,m(v.value),1)):p("",!0)]))}};export{Oe as default};
