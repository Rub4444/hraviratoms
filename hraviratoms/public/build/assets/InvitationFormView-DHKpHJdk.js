import{f as h,r as p,o as M,c as o,a as t,t as n,w as N,e as x,g as i,v as R,F as V,b as U,h as d,i as $,j as S,u as q,k as A,d as r}from"./app-BFZ9Kyn7.js";const B={class:"mb-2 text-2xl font-semibold"},I={class:"mb-5 text-sm text-slate-600"},K={class:"grid gap-6 md:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)]"},L={class:"grid gap-4 md:grid-cols-2"},O={key:0,class:"col-span-2"},W=["value"],X={key:0},G={class:"grid gap-4 md:grid-cols-2"},H=["onUpdate:modelValue"],J=["onUpdate:modelValue"],z={class:"flex items-center justify-between pt-2"},Q={class:"inline-flex items-center gap-2 text-xs text-slate-600"},Y=["disabled"],Z={key:0,class:"text-xs text-red-500"},ee={class:"hidden md:block"},te={class:"invite-page rounded-3xl border bg-slate-100 p-4"},se={class:"card-soft"},le={class:"px-6 pt-8 pb-6 text-center"},ae={class:"invite-names mt-3"},oe={key:0,class:"mt-3 text-xs tracking-[0.25em] uppercase invite-accent"},ne={key:0},ie={key:1,class:"mt-3 text-sm text-slate-600"},de={__name:"InvitationFormView",props:{id:{type:String,default:null},templateKey:{type:String,default:null}},setup(E){var w;q();const T=A(),j=((w=document.querySelector('meta[name="csrf-token"]'))==null?void 0:w.getAttribute("content"))||"",m=E,v=h(()=>!!m.id),c=p(null),C=h(()=>!c.value&&!v.value?"":c.value?`${c.value.name} template`:"Existing invitation"),l=p({invitation_template_id:null,bride_name:"",groom_name:"",date:"",time:"",venue_name:"",venue_address:"",dress_code:"",is_published:!1,user_id:null}),y=p([]),k=p(!1),F=async()=>{k.value=!0;try{const a=await fetch("/api/users");if(!a.ok)return;const e=await a.json();y.value=e}catch(a){console.error("Error loading users",a)}finally{k.value=!1}},g=p([{time:"18:00",label:"Welcome drink"},{time:"19:00",label:"Ceremony"},{time:"20:00",label:"Dinner & party"}]),_=p(!1),b=p(""),P=()=>{g.value.push({time:"",label:""})};M(async()=>{var a;await F();try{if(v.value&&m.id){const e=await fetch(`/api/invitations/${m.id}`);if(!e.ok)return[];const s=await e.json();c.value=s.template,l.value.invitation_template_id=s.invitation_template_id,l.value.bride_name=s.bride_name,l.value.groom_name=s.groom_name,l.value.date=s.date||"",l.value.time=s.time||"",l.value.venue_name=s.venue_name||"",l.value.venue_address=s.venue_address||"",l.value.dress_code=s.dress_code||"",l.value.is_published=!!s.is_published,l.value.user_id=s.user_id??null;const u=(a=s.data)==null?void 0:a.program;Array.isArray(u)&&u.length&&(g.value=u)}else if(!v.value&&m.templateKey){const e=await fetch(`/api/templates/${m.templateKey}`);if(!e.ok)throw new Error("Failed to load template");c.value=await e.json(),l.value.invitation_template_id=c.value.id}}catch(e){console.error(e),b.value=e.message||"Failed to load data"}});const D=async()=>{_.value=!0,b.value="";try{const a={...l.value,data:{program:g.value}};let e="/api/invitations",s="POST";v.value&&m.id&&(e=`/api/invitations/${m.id}`,s="PUT");const u=await fetch(e,{method:s,headers:{"X-CSRF-TOKEN":j,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(a)});if(!u.ok)throw new Error("Failed to save invitation");const f=await u.json();v.value?alert("Invitation updated!"):alert(`Invitation created! Public URL: ${window.location.origin}/i/${f.slug}`),T.push({name:"invitations.index"})}catch(a){b.value=a.message||"Error saving invitation"}finally{_.value=!1}};return(a,e)=>(r(),o("section",null,[t("h1",B,n(v.value?"Edit invitation":"Create invitation"),1),t("p",I,n(C.value),1),t("div",K,[t("form",{class:"space-y-4",onSubmit:N(D,["prevent"])},[t("div",L,[y.value.length?(r(),o("div",O,[e[10]||(e[10]=t("label",{class:"block text-[11px] font-medium text-slate-600 mb-1"}," Кто может видеть статистику (владелец) ",-1)),i(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.user_id=s),class:"mt-1 block w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-leaf focus:ring-leaf"},[e[9]||(e[9]=t("option",{value:null}," Только супер-админ (не привязано к аккаунту) ",-1)),(r(!0),o(V,null,U(y.value,s=>(r(),o("option",{key:s.id,value:s.id},[S(n(s.name)+" ("+n(s.email)+") ",1),s.is_superadmin?(r(),o("span",X,"— Superadmin")):x("",!0)],8,W))),128))],512),[[R,l.value.user_id]])])):x("",!0),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-xs font-medium text-slate-700"},"Bride name",-1)),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.bride_name=s),type:"text",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400",required:""},null,512),[[d,l.value.bride_name]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-xs font-medium text-slate-700"},"Groom name",-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.groom_name=s),type:"text",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400",required:""},null,512),[[d,l.value.groom_name]])])]),t("div",G,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-xs font-medium text-slate-700"},"Date",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.date=s),type:"date",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[d,l.value.date]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-xs font-medium text-slate-700"},"Time",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.time=s),type:"text",placeholder:"18:00",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[d,l.value.time]])])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-xs font-medium text-slate-700"},"Venue name",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.venue_name=s),type:"text",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[d,l.value.venue_name]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-xs font-medium text-slate-700"},"Venue address",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.venue_address=s),type:"text",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[d,l.value.venue_address]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-xs font-medium text-slate-700"},"Dress code",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.dress_code=s),type:"text",placeholder:"Elegant / Festive",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[d,l.value.dress_code]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Program",-1)),(r(!0),o(V,null,U(g.value,(s,u)=>(r(),o("div",{key:u,class:"mb-2 flex gap-2"},[i(t("input",{"onUpdate:modelValue":f=>s.time=f,type:"text",placeholder:"18:00",class:"block w-24 rounded-xl border-slate-200 text-xs shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,8,H),[[d,s.time]]),i(t("input",{"onUpdate:modelValue":f=>s.label=f,type:"text",placeholder:"Welcome drink",class:"block flex-1 rounded-xl border-slate-200 text-xs shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,8,J),[[d,s.label]])]))),128)),t("button",{type:"button",class:"btn-primary",onClick:P}," + Add program item ")]),t("div",z,[t("label",Q,[i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.is_published=s),type:"checkbox",class:"rounded border-slate-300 text-rose-500 focus:ring-rose-400"},null,512),[[$,l.value.is_published]]),e[19]||(e[19]=t("span",null,"Publish invitation",-1))]),t("button",{type:"submit",class:"rounded-full bg-rose-500 px-4 py-1.5 text-xs font-medium text-white hover:bg-rose-600",disabled:_.value},n(_.value?"Saving...":v.value?"Save changes":"Create invitation"),9,Y)]),b.value?(r(),o("p",Z,n(b.value),1)):x("",!0)],32),t("div",ee,[e[21]||(e[21]=t("h2",{class:"mb-3 text-sm font-medium text-slate-700"},"Preview",-1)),t("div",te,[t("div",se,[t("div",le,[e[20]||(e[20]=t("p",{class:"text-[10px] tracking-[0.35em] uppercase text-slate-400"}," Օնլայն հրավիրատոմս ",-1)),t("h1",ae,n(l.value.bride_name||"Bride")+" & "+n(l.value.groom_name||"Groom"),1),l.value.date||l.value.time?(r(),o("p",oe,[S(n(l.value.date||"2025-11-16")+" ",1),l.value.time?(r(),o("span",ne," • "+n(l.value.time),1)):x("",!0)])):x("",!0),l.value.venue_name?(r(),o("p",ie,n(l.value.venue_name),1)):x("",!0)])])]),e[22]||(e[22]=t("p",{class:"mt-2 text-[11px] text-slate-500"}," Стиль превью будет зависеть от темы (Elegant, Nature, Luxury, Pastel). ",-1))])])]))}};export{de as default};
