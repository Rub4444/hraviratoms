import{c as d,g as a,a as e,t as r,h as A,w as h,e as f,d as v,u as b,r as w,i as V,o as q,b as $,j as z,v as H,F as j,f as N}from"./app-B99yQ8pg.js";import{a as O,b as R,_ as D}from"./Badge-Dr0HG7bP.js";function J(){var s;return((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}function B(){var s;return((s=document.querySelector('meta[name="superadmin"]'))==null?void 0:s.getAttribute("content"))==="1"}const P={Accept:"application/json"};async function K(){const s=await fetch("/api/invitations",{headers:P});return s.status===403?{invitations:[],error:null}:s.ok?{invitations:await s.json(),error:null}:{invitations:[],error:"Не удалось загрузить приглашения"}}async function F(s){const u=await fetch(`/api/invitations/${s}`,{method:"DELETE",headers:{...P,"X-CSRF-TOKEN":J()}});if(!u.ok)throw new Error(`Delete failed with status ${u.status}`);return!0}async function X(s=[]){const u=[];for(const m of s)try{await F(m),u.push({id:m,success:!0})}catch(x){console.warn("Bulk delete error for",m,x),u.push({id:m,success:!1})}return u}const G={key:0,class:"border-t last:border-b hover:bg-slate-50/60"},Q={class:"px-4 py-3 align-top w-8"},W=["value","checked"],Y={class:"px-4 py-3 align-top"},Z={class:"font-medium text-slate-900"},_={class:"text-xs text-slate-500"},ee={class:"px-4 py-3 align-top text-xs text-slate-600"},te={class:"px-4 py-3 align-top text-xs text-slate-600"},se={class:"px-4 py-3 align-top text-xs text-slate-600"},le={key:0},ie={key:1},ne={class:"px-4 py-3 align-top text-xs"},oe={class:"px-4 py-3 align-top text-xs"},ae={key:0},de={class:"max-w-[200px] truncate text-slate-600"},re={key:1,class:"text-red-500 text-sm"},ue={class:"px-4 py-3 align-top text-right text-xs"},me={class:"flex flex-wrap justify-end gap-2"},ce={key:1,class:"rounded-2xl border border-slate-200 bg-white p-3 shadow-sm"},ve={class:"flex items-start justify-between gap-2"},pe={class:"flex items-center gap-2"},fe=["value","checked"],xe={class:"font-medium text-slate-900 text-sm"},be={class:"mt-0.5 text-[11px] text-slate-500"},ye={class:"mt-2 grid grid-cols-2 gap-1 text-[11px] text-slate-600"},ge={class:"mt-3 flex flex-wrap gap-2 text-[11px]"},T={__name:"InvitationItem",props:{item:Object,mode:String,selected:Boolean},setup(s){const u=s,m=B(),x=`${window.location.origin}/i/${u.item.slug}`,y=l=>new Date(l).toLocaleDateString("ru-RU");return(l,i)=>{var C,p,S,k;return s.mode==="desktop"?(a(),d("tr",G,[e("td",Q,[e("input",{type:"checkbox",value:s.item.id,checked:s.selected,onChange:i[0]||(i[0]=c=>l.$emit("select",s.item.id,c))},null,40,W)]),e("td",Y,[e("div",Z,r(s.item.bride_name)+" & "+r(s.item.groom_name),1),e("div",_,r(s.item.title||"—"),1)]),e("td",ee,r(((C=s.item.template)==null?void 0:C.name)||"—"),1),e("td",te,r(((p=s.item.user)==null?void 0:p.name)||"Superadmin only"),1),e("td",se,[s.item.date?(a(),d("span",le,r(y(s.item.date)),1)):(a(),d("span",ie,"—"))]),e("td",ne,[A(O,{type:s.item.is_published?"success":"gray"},{default:h(()=>[f(r(s.item.is_published?"Published":"Draft"),1)]),_:1},8,["type"])]),e("td",oe,[s.item.is_published?(a(),d("div",ae,[e("div",de,r(s.item.slug),1),e("button",{class:"mt-1 text-[11px] text-rose-500 hover:text-rose-600",type:"button",onClick:i[1]||(i[1]=c=>l.$emit("copy",s.item))}," Copy link ")])):(a(),d("div",re,"-"))]),e("td",ue,[e("div",me,[b(m)?(a(),d("a",{key:0,href:x,target:"_blank",class:"rounded-full border border-slate-200 px-3 py-1 font-medium hover:bg-slate-50"}," Open ")):v("",!0),b(m)?(a(),d("button",{key:1,class:"rounded-full bg-slate-900 px-3 py-1 font-medium text-white hover:bg-slate-800",onClick:i[2]||(i[2]=c=>l.$emit("edit",s.item))}," Edit ")):v("",!0),e("button",{class:"rounded-full border border-leaf-soft px-3 py-1 font-medium text-leaf-deep hover:bg-leaf-soft/20",onClick:i[3]||(i[3]=c=>l.$emit("rsvp",s.item))}," RSVP "),b(m)?(a(),d("button",{key:2,class:"rounded-full bg-red-500 px-3 py-1 font-medium text-white hover:bg-red-600",onClick:i[4]||(i[4]=c=>l.$emit("delete",s.item))}," Delete ")):v("",!0)])])])):(a(),d("div",ce,[e("div",ve,[e("div",null,[e("div",pe,[e("input",{type:"checkbox",value:s.item.id,checked:s.selected,onChange:i[5]||(i[5]=c=>l.$emit("select",s.item.id,c))},null,40,fe),e("div",xe,r(s.item.bride_name)+" & "+r(s.item.groom_name),1)]),e("div",be,r(s.item.title||"—"),1)]),A(O,{type:s.item.is_published?"success":"gray"},{default:h(()=>[f(r(s.item.is_published?"Published":"Draft"),1)]),_:1},8,["type"])]),e("div",ye,[e("div",null,[i[10]||(i[10]=e("span",{class:"font-semibold"},"Template:",-1)),f(" "+r(((S=s.item.template)==null?void 0:S.name)||"—"),1)]),e("div",null,[i[11]||(i[11]=e("span",{class:"font-semibold"},"Owner:",-1)),f(" "+r(((k=s.item.user)==null?void 0:k.name)||"—"),1)]),e("div",null,[i[12]||(i[12]=e("span",{class:"font-semibold"},"Date:",-1)),f(" "+r(s.item.date?y(s.item.date):"—"),1)]),e("div",null,[i[13]||(i[13]=e("span",{class:"font-semibold"},"Link:",-1)),f(" "+r(s.item.is_published?s.item.slug:"-"),1)])]),e("div",ge,[s.item.is_published?(a(),d("button",{key:0,class:"rounded-full border border-rose-200 px-3 py-1 text-rose-500 hover:bg-rose-50",onClick:i[6]||(i[6]=c=>l.$emit("copy",s.item))}," Copy link ")):v("",!0),b(m)?(a(),d("a",{key:1,href:x,target:"_blank",class:"rounded-full border border-slate-200 px-3 py-1 font-medium text-slate-800 hover:bg-slate-50"}," Open ")):v("",!0),b(m)?(a(),d("button",{key:2,class:"rounded-full bg-slate-900 px-3 py-1 font-medium text-white hover:bg-slate-800",onClick:i[7]||(i[7]=c=>l.$emit("edit",s.item))}," Edit ")):v("",!0),e("button",{class:"rounded-full border border-leaf-soft px-3 py-1 font-medium text-leaf-deep hover:bg-leaf-soft/20",onClick:i[8]||(i[8]=c=>l.$emit("rsvp",s.item))}," RSVP "),b(m)?(a(),d("button",{key:3,class:"ml-auto rounded-full bg-red-500 px-3 py-1 font-medium text-white hover:bg-red-600",onClick:i[9]||(i[9]=c=>l.$emit("delete",s.item))}," Delete ")):v("",!0)])]))}}},he={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ke={class:"flex flex-wrap items-center gap-2"},we={key:2},$e={class:"min-w-full text-left text-sm"},Ce={class:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500"},Se={class:"w-8 px-4 py-3"},De=["checked"],Ae={class:"mt-3 space-y-3 md:hidden"},Ee={class:"flex items-center justify-between text-xs text-slate-600"},Ie={class:"flex items-center gap-2"},Le=["checked"],Ve={key:0},je={key:3,class:"mt-3 text-xs text-red-500"},Re={__name:"InvitationsListView",setup(s){const u=w([]),m=w(!0),x=w(""),y=w("all"),l=w([]),i=w(B()),C=i,p=V(()=>u.value.filter(o=>y.value==="published"?!!o.is_published:y.value==="draft"?!o.is_published:!0)),S=V(()=>p.value.length?p.value.every(o=>l.value.includes(o.id)):!1),k=o=>`${window.location.origin}/i/${o.slug}`,c=async o=>{const t=k(o);try{await navigator.clipboard.writeText(t),alert("Link copied!")}catch{prompt("Copy this link:",t)}},U=async()=>{m.value=!0,x.value="";const{invitations:o,error:t}=await K();t?(x.value=t,u.value=[]):u.value=o,m.value=!1},E=async o=>{if(confirm(`Удалить приглашение для пары "${o.bride_name} & ${o.groom_name}"?`))try{await F(o.id),u.value=u.value.filter(n=>n.id!==o.id),l.value=l.value.filter(n=>n!==o.id),alert("Invitation deleted")}catch(n){console.error(n),alert("Failed to delete invitation")}},I=(o,t)=>{t.target.checked?l.value.includes(o)||l.value.push(o):l.value=l.value.filter(n=>n!==o)},L=o=>{if(o.target.checked){const t=p.value.map(n=>n.id);l.value=Array.from(new Set([...l.value,...t]))}else{const t=p.value.map(n=>n.id);l.value=l.value.filter(n=>!t.includes(n))}},M=async()=>{!l.value.length||!confirm(`Удалить выбранные приглашения (${l.value.length} шт.)?`)||(await X(l.value),u.value=u.value.filter(t=>!l.value.includes(t.id)),l.value=[],alert("Selected invitations deleted"))};return q(U),(o,t)=>(a(),d("section",null,[e("div",he,[t[10]||(t[10]=e("div",null,[e("h1",{class:"text-xl sm:text-2xl font-semibold"},"My invitations"),e("p",{class:"mt-1 text-xs sm:text-sm text-slate-600"}," Здесь отображаются все созданные приглашения с публичными ссылками. ")],-1)),e("div",ke,[i.value?z((a(),d("select",{key:0,"onUpdate:modelValue":t[0]||(t[0]=n=>y.value=n),class:"rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-700"},[...t[8]||(t[8]=[e("option",{value:"all"},"Все",-1),e("option",{value:"published"},"Только published",-1),e("option",{value:"draft"},"Только draft",-1)])],512)),[[H,y.value]]):v("",!0),i.value&&l.value.length?(a(),$(R,{key:1,type:"button",variant:"danger",size:"xs",class:"rounded-full px-3 py-1 text-xs",onClick:M},{default:h(()=>[f(" Delete selected ("+r(l.value.length)+") ",1)]),_:1})):v("",!0),i.value?(a(),$(R,{key:2,variant:"primary",size:"xs",class:"btn-primary text-xs",onClick:t[1]||(t[1]=n=>o.$router.push({name:"templates.index"}))},{default:h(()=>[...t[9]||(t[9]=[f(" + New invitation ",-1)])]),_:1})):v("",!0)])]),m.value?(a(),$(D,{key:0,class:"rounded-2xl border bg-white p-4 text-sm text-slate-500 shadow-sm"},{default:h(()=>[...t[11]||(t[11]=[f(" Loading invitations... ",-1)])]),_:1})):p.value.length?(a(),d("div",we,[A(D,{class:"hidden overflow-hidden rounded-2xl border bg-white p-0 shadow-sm md:block"},{default:h(()=>[e("table",$e,[e("thead",Ce,[e("tr",null,[e("th",Se,[e("input",{type:"checkbox",checked:S.value,onChange:t[2]||(t[2]=n=>L(n))},null,40,De)]),t[13]||(t[13]=e("th",{class:"px-4 py-3"},"Couple",-1)),t[14]||(t[14]=e("th",{class:"px-4 py-3"},"Template",-1)),t[15]||(t[15]=e("th",{class:"px-4 py-3"},"Owner",-1)),t[16]||(t[16]=e("th",{class:"px-4 py-3"},"Date",-1)),t[17]||(t[17]=e("th",{class:"px-4 py-3"},"Published",-1)),t[18]||(t[18]=e("th",{class:"px-4 py-3"},"Link",-1)),t[19]||(t[19]=e("th",{class:"px-4 py-3 text-right"},"Actions",-1))])]),e("tbody",null,[(a(!0),d(j,null,N(p.value,n=>(a(),$(T,{key:n.id,item:n,mode:"desktop",selected:l.value.includes(n.id),"is-super-admin":b(C),"public-url":k(n),onSelect:I,onCopy:c,onEdit:t[3]||(t[3]=g=>o.$router.push({name:"invitations.edit",params:{id:g.id}})),onRsvp:t[4]||(t[4]=g=>o.$router.push({name:"invitations.rsvps",params:{id:g.id}})),onDelete:E},null,8,["item","selected","is-super-admin","public-url"]))),128))])])]),_:1}),e("div",Ae,[e("div",Ee,[e("label",Ie,[e("input",{type:"checkbox",checked:S.value,onChange:t[5]||(t[5]=n=>L(n))},null,40,Le),t[20]||(t[20]=e("span",null,"Выбрать все",-1))]),l.value.length?(a(),d("span",Ve," Выбрано: "+r(l.value.length),1)):v("",!0)]),(a(!0),d(j,null,N(p.value,n=>(a(),$(T,{key:n.id,item:n,mode:"mobile",selected:l.value.includes(n.id),"is-super-admin":b(C),"public-url":k(n),onSelect:I,onCopy:c,onEdit:t[6]||(t[6]=g=>o.$router.push({name:"invitations.edit",params:{id:g.id}})),onRsvp:t[7]||(t[7]=g=>o.$router.push({name:"invitations.rsvps",params:{id:g.id}})),onDelete:E},null,8,["item","selected","is-super-admin","public-url"]))),128))])])):(a(),$(D,{key:1,class:"rounded-2xl border bg-white p-4 text-sm text-slate-500 shadow-sm"},{default:h(()=>[...t[12]||(t[12]=[f(" Пока нет ни одного приглашения. ",-1)])]),_:1})),x.value?(a(),d("p",je,r(x.value),1)):v("",!0)]))}};export{Re as default};
