import{r as c,e as S,o as F,c as n,a as t,f as p,w as V,v as N,t as i,F as O,b as P,d as a}from"./app-DttdDNZ_.js";const R={class:"mb-4 flex items-center justify-between gap-2"},q={class:"flex items-center gap-2"},B={key:0,class:"rounded-2xl border bg-white p-4 text-sm text-slate-500 shadow-sm"},M={key:1,class:"rounded-2xl border bg-white p-4 text-sm text-slate-500 shadow-sm"},U={key:2,class:"overflow-hidden rounded-2xl border bg-white shadow-sm"},K={class:"min-w-full text-left text-sm"},X={class:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500"},z={class:"px-4 py-3 w-8"},G=["checked"],H={class:"px-4 py-3 align-top"},J=["value","checked","onChange"],Q={class:"px-4 py-3 align-top"},W={class:"font-medium text-slate-900"},Y={class:"text-xs text-slate-500"},Z={class:"px-4 py-3 align-top text-xs text-slate-600"},ee={class:"px-4 py-3 align-top text-xs text-slate-600"},te={class:"px-4 py-3 align-top text-xs text-slate-600"},se={key:0},le={key:1},oe={class:"px-4 py-3 align-top text-xs"},ne={key:0,class:"inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-medium text-emerald-700"},ae={key:1,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-[11px] font-medium text-slate-500"},re={class:"px-4 py-3 align-top text-xs"},ie={key:0},de={class:"max-w-[200px] truncate text-slate-600"},ue=["onClick"],ce={key:1,class:"text-red-500 text-sm"},pe={class:"px-4 py-3 align-top text-right text-xs"},xe={class:"flex flex-wrap justify-end gap-2"},me=["href"],he=["onClick"],fe=["onClick"],ve=["onClick"],ye={key:3,class:"mt-3 text-xs text-red-500"},_e={__name:"InvitationsListView",setup(be){var _,k,w;const f=((_=document.querySelector('meta[name="superadmin"]'))==null?void 0:_.getAttribute("content"))==="1",r=c([]),v=c(!0),x=c(""),h=c("all"),o=c([]),y=c(((k=document.querySelector('meta[name="superadmin"]'))==null?void 0:k.getAttribute("content"))==="1"),b=((w=document.querySelector('meta[name="csrf-token"]'))==null?void 0:w.getAttribute("content"))||"",d=S(()=>r.value.filter(l=>h.value==="published"?!!l.is_published:h.value==="draft"?!l.is_published:!0)),$=S(()=>d.value.length?d.value.every(l=>o.value.includes(l.id)):!1),g=l=>`${window.location.origin}/i/${l.slug}`,D=async l=>{const e=g(l);try{await navigator.clipboard.writeText(e),alert("Link copied!")}catch{prompt("Copy this link:",e)}},E=l=>{if(!l)return"";try{return new Date(l).toLocaleDateString("ru-RU")}catch{return l}},A=async()=>{v.value=!0,x.value="";try{const l=await fetch("/api/invitations",{headers:{Accept:"application/json"}});if(l.status===403){r.value=[];return}if(!l.ok){x.value="Не удалось загрузить приглашения",r.value=[];return}r.value=await l.json()}catch{x.value="Ошибка при загрузке приглашений",r.value=[]}finally{v.value=!1}},L=async l=>{if(confirm(`Удалить приглашение для пары "${l.bride_name} & ${l.groom_name}"?`))try{if(!(await fetch(`/api/invitations/${l.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":b,Accept:"application/json"}})).ok){alert("Failed to delete invitation");return}r.value=r.value.filter(u=>u.id!==l.id),o.value=o.value.filter(u=>u!==l.id),alert("Invitation deleted")}catch{alert("Error deleting invitation")}},I=(l,e)=>{e.target.checked?o.value.includes(l)||o.value.push(l):o.value=o.value.filter(s=>s!==l)},T=l=>{if(l.target.checked){const e=d.value.map(s=>s.id);o.value=Array.from(new Set([...o.value,...e]))}else{const e=d.value.map(s=>s.id);o.value=o.value.filter(s=>!e.includes(s))}},j=async()=>{if(!(!o.value.length||!confirm(`Удалить выбранные приглашения (${o.value.length} шт.)?`))){for(const e of o.value)try{(await fetch(`/api/invitations/${e}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":b,Accept:"application/json"}})).ok}catch{}r.value=r.value.filter(e=>!o.value.includes(e.id)),o.value=[],alert("Selected invitations deleted")}};return F(A),(l,e)=>(a(),n("section",null,[t("div",R,[e[4]||(e[4]=t("div",null,[t("h1",{class:"text-2xl font-semibold"},"My invitations"),t("p",{class:"mt-1 text-sm text-slate-600"}," Здесь отображаются все созданные приглашения с публичными ссылками. ")],-1)),t("div",q,[V(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),class:"rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-700"},[...e[3]||(e[3]=[t("option",{value:"all"},"Все",-1),t("option",{value:"published"},"Только published",-1),t("option",{value:"draft"},"Только draft",-1)])],512),[[N,h.value]]),y.value&&o.value.length?(a(),n("button",{key:0,type:"button",class:"rounded-full bg-red-500 px-3 py-1 text-xs font-medium text-white hover:bg-red-600",onClick:j}," Delete selected ("+i(o.value.length)+") ",1)):p("",!0),y.value?(a(),n("button",{key:1,class:"btn-primary",onClick:e[1]||(e[1]=s=>l.$router.push({name:"templates.index"}))}," + New invitation ")):p("",!0)])]),v.value?(a(),n("div",B," Loading invitations... ")):d.value.length?(a(),n("div",U,[t("table",K,[t("thead",X,[t("tr",null,[t("th",z,[t("input",{type:"checkbox",checked:$.value,onChange:e[2]||(e[2]=s=>T(s))},null,40,G)]),e[5]||(e[5]=t("th",{class:"px-4 py-3"},"Couple",-1)),e[6]||(e[6]=t("th",{class:"px-4 py-3"},"Template",-1)),e[7]||(e[7]=t("th",{class:"px-4 py-3"},"Owner",-1)),e[8]||(e[8]=t("th",{class:"px-4 py-3"},"Date",-1)),e[9]||(e[9]=t("th",{class:"px-4 py-3"},"Published",-1)),e[10]||(e[10]=t("th",{class:"px-4 py-3"},"Link",-1)),e[11]||(e[11]=t("th",{class:"px-4 py-3 text-right"},"Actions",-1))])]),t("tbody",null,[(a(!0),n(O,null,P(d.value,s=>{var u,C;return a(),n("tr",{key:s.id,class:"border-t last:border-b hover:bg-slate-50/60"},[t("td",H,[t("input",{type:"checkbox",value:s.id,checked:o.value.includes(s.id),onChange:m=>I(s.id,m)},null,40,J)]),t("td",Q,[t("div",W,i(s.bride_name)+" & "+i(s.groom_name),1),t("div",Y,i(s.title||"—"),1)]),t("td",Z,i(((u=s.template)==null?void 0:u.name)||"—"),1),t("td",ee,i(((C=s.user)==null?void 0:C.name)||"Superadmin only"),1),t("td",te,[s.date?(a(),n("span",se,i(E(s.date)),1)):(a(),n("span",le,"—"))]),t("td",oe,[s.is_published?(a(),n("span",ne," Published ")):(a(),n("span",ae," Draft "))]),t("td",re,[s.is_published?(a(),n("div",ie,[t("div",de,i(s.slug),1),t("button",{class:"mt-1 text-[11px] text-rose-500 hover:text-rose-600",type:"button",onClick:m=>D(s)}," Copy link ",8,ue)])):(a(),n("div",ce," - "))]),t("td",pe,[t("div",xe,[f?(a(),n("a",{key:0,href:g(s),target:"_blank",class:"rounded-full border border-slate-200 px-3 py-1 font-medium hover:bg-slate-50"}," Open ",8,me)):p("",!0),f?(a(),n("button",{key:1,class:"rounded-full bg-slate-900 px-3 py-1 font-medium text-white hover:bg-slate-800",type:"button",onClick:m=>l.$router.push({name:"invitations.edit",params:{id:s.id}})}," Edit ",8,he)):p("",!0),t("button",{class:"rounded-full border border-leaf-soft px-3 py-1 font-medium text-leaf-deep hover:bg-leaf-soft/20",type:"button",onClick:m=>l.$router.push({name:"invitations.rsvps",params:{id:s.id}})}," RSVP ",8,fe),f?(a(),n("button",{key:2,class:"rounded-full bg-red-500 px-3 py-1 font-medium text-white hover:bg-red-600",type:"button",onClick:m=>L(s)}," Delete ",8,ve)):p("",!0)])])])}),128))])])])):(a(),n("div",M," Пока нет ни одного приглашения. ")),x.value?(a(),n("p",ye,i(x.value),1)):p("",!0)]))}};export{_e as default};
