import{r as i,j,f as o,g as e,l as h,F,A as N,z as d,H as T,B as f,I as g,J as V,o as n}from"./runtime-dom.esm-bundler-CaHSP4Q1.js";const O={key:0,class:"rounded-2xl border bg-white p-4 text-sm text-slate-500 shadow-sm"},$={key:1,class:"rounded-2xl border bg-white p-4 text-sm text-slate-500 shadow-sm"},q={key:2,class:"overflow-hidden rounded-2xl border bg-white shadow-sm"},A={class:"min-w-full text-left text-sm"},D={class:"px-4 py-3 align-top"},B={class:"font-medium text-slate-900"},L={class:"px-4 py-3 align-top text-xs text-slate-600"},M={class:"px-4 py-3 align-top text-xs"},I={key:0,class:"inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-medium text-emerald-700"},J={key:1,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-[11px] font-medium text-slate-500"},K={class:"px-4 py-3 align-top text-xs text-slate-600"},P={class:"px-4 py-3 align-top text-right text-xs"},R={class:"flex flex-wrap justify-end gap-2"},z=["onClick"],X=["onClick"],H={key:3,class:"mt-3 text-xs text-red-500"},G={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40"},Q={class:"w-full max-w-md rounded-2xl bg-white p-5 shadow-xl"},W={class:"mb-3 text-lg font-semibold"},Y=["placeholder","required"],Z={class:"inline-flex items-center gap-2 text-xs text-slate-700"},ee={class:"mt-4 flex justify-end gap-2"},te=["disabled"],se={key:0,class:"mt-2 text-xs text-red-500"},oe={__name:"UsersListView",setup(le){var _;const v=i([]),b=i(!0),m=i(""),c=i(!1),r=i(null),a=i({name:"",email:"",password:"",is_superadmin:!1}),p=i(!1),u=i(""),w=((_=document.querySelector('meta[name="csrf-token"]'))==null?void 0:_.getAttribute("content"))||"",y=async()=>{b.value=!0,m.value="";try{const l=await fetch("/api/users");if(!l.ok)throw new Error("Failed to load users");v.value=await l.json()}catch(l){console.error(l),m.value=l.message||"Error loading users"}finally{b.value=!1}},k=()=>{r.value=null,a.value={name:"",email:"",password:"",is_superadmin:!1},u.value="",c.value=!0},E=l=>{r.value=l,a.value={name:l.name,email:l.email,password:"",is_superadmin:!!l.is_superadmin},u.value="",c.value=!0},C=()=>{c.value=!1},S=async()=>{p.value=!0,u.value="";try{const l={...a.value},t=r.value?`/api/users/${r.value.id}`:"/api/users",s=r.value?"PUT":"POST",x=await fetch(t,{method:s,headers:{"X-CSRF-TOKEN":w,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(l)});if(!x.ok)throw console.error("Save user error status:",x.status),new Error("Failed to save user");await y(),c.value=!1}catch(l){console.error(l),u.value=l.message||"Error saving user"}finally{p.value=!1}},U=async l=>{if(!confirm(`Удалить пользователя "${l.name}" (${l.email})?`))return;const t=confirm('Также удалить все его приглашения? Нажмите "OK" — удалить вместе с приглашениями, "Cancel" — только отвязать приглашения.');try{const s=await fetch(`/api/users/${l.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":w,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({delete_invitations:t})});if(!s.ok)throw console.error("Delete user error status:",s.status),new Error("Failed to delete user");await y()}catch(s){console.error(s),alert(s.message||"Error deleting user")}};return j(y),(l,t)=>(n(),o("section",null,[e("div",{class:"mb-4 flex items-center justify-between gap-2"},[t[4]||(t[4]=e("div",null,[e("h1",{class:"text-2xl font-semibold"},"Users"),e("p",{class:"mt-1 text-sm text-slate-600"}," Управление аккаунтами и правами супер-админа. ")],-1)),e("button",{class:"btn-primary",type:"button",onClick:k}," + New user ")]),b.value?(n(),o("div",O," Loading users... ")):v.value.length?(n(),o("div",q,[e("table",A,[t[5]||(t[5]=e("thead",{class:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500"},[e("tr",null,[e("th",{class:"px-4 py-3"},"Name"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Role"),e("th",{class:"px-4 py-3"},"Invitations"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(n(!0),o(F,null,N(v.value,s=>(n(),o("tr",{key:s.id,class:"border-t last:border-b hover:bg-slate-50/60"},[e("td",D,[e("div",B,d(s.name),1)]),e("td",L,d(s.email),1),e("td",M,[s.is_superadmin?(n(),o("span",I," Superadmin ")):(n(),o("span",J," User "))]),e("td",K,d(s.invitations_count??0),1),e("td",P,[e("div",R,[e("button",{class:"rounded-full border border-slate-200 px-3 py-1 font-medium hover:bg-slate-50",type:"button",onClick:x=>E(s)}," Edit ",8,z),e("button",{class:"rounded-full bg-red-500 px-3 py-1 font-medium text-white hover:bg-red-600",type:"button",onClick:x=>U(s)}," Delete ",8,X)])])]))),128))])])])):(n(),o("div",$," Пока нет ни одного пользователя. ")),m.value?(n(),o("p",H,d(m.value),1)):h("",!0),c.value?(n(),o("div",G,[e("div",Q,[e("h2",W,d(r.value?"Edit user":"Create user"),1),e("form",{class:"space-y-3",onSubmit:T(S,["prevent"])},[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-xs font-medium text-slate-700"}," Name ",-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>a.value.name=s),type:"text",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-leaf focus:ring-leaf",required:""},null,512),[[g,a.value.name]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-xs font-medium text-slate-700"}," Email ",-1)),f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.email=s),type:"email",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-leaf focus:ring-leaf",required:""},null,512),[[g,a.value.email]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-xs font-medium text-slate-700"}," Password ",-1)),f(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.password=s),placeholder:r.value?"Оставьте пустым, чтобы не менять":"",type:"password",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-leaf focus:ring-leaf",required:!r.value},null,8,Y),[[g,a.value.password]])]),e("label",Z,[f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.is_superadmin=s),type:"checkbox",class:"rounded border-slate-300 text-leaf focus:ring-leaf"},null,512),[[V,a.value.is_superadmin]]),t[9]||(t[9]=e("span",null,"Superadmin",-1))]),e("div",ee,[e("button",{type:"button",class:"rounded-full border border-slate-200 px-4 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-50",onClick:C}," Cancel "),e("button",{type:"submit",class:"rounded-full bg-leaf px-4 py-1.5 text-xs font-medium text-white hover:bg-leaf-deep",disabled:p.value},d(p.value?"Saving...":"Save"),9,te)]),u.value?(n(),o("p",se,d(u.value),1)):h("",!0)],32)])])):h("",!0)]))}};export{oe as default};
