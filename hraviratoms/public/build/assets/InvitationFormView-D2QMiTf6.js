import{r as v,c as V,j as M,f as r,g as t,l as c,z as n,H as N,B as d,C as R,F as S,A as C,I as p,J as q,x as E,o as i}from"./runtime-dom.esm-bundler-CaHSP4Q1.js";import{a as I,u as K,b as L}from"./app-5hV_1kiU.js";const O={class:"mb-2 text-2xl font-semibold"},W={class:"mb-5 text-sm text-slate-600"},X=["disabled"],G={key:0,class:"mt-1 text-[11px] text-red-500"},H={class:"grid gap-6 md:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)]"},J={class:"grid gap-4 md:grid-cols-2"},z={key:0,class:"col-span-2"},Q=["value"],Y={key:0},Z={class:"grid gap-4 md:grid-cols-2"},ee=["onUpdate:modelValue"],te=["onUpdate:modelValue"],se={class:"flex items-center justify-between pt-2"},le={class:"inline-flex items-center gap-2 text-xs text-slate-600"},ae=["disabled"],oe={key:0,class:"text-xs text-red-500"},ne={class:"hidden md:block"},re={class:"invite-page rounded-3xl border bg-slate-100 p-4"},ie={class:"card-soft"},de={class:"px-6 pt-8 pb-6 text-center"},ue={class:"invite-names mt-3"},me={key:0,class:"mt-3 text-xs tracking-[0.25em] uppercase invite-accent"},ve={key:0},pe={key:1,class:"mt-3 text-sm text-slate-600"},be={__name:"InvitationFormView",props:{id:{type:String,default:null},templateKey:{type:String,default:null}},setup(T){var U;K();const j=L(),_=v(!1),x=v(null),F=((U=document.querySelector('meta[name="csrf-token"]'))==null?void 0:U.getAttribute("content"))||"",u=T,m=V(()=>!!u.id),b=v(null),P=V(()=>!b.value&&!m.value?"":b.value?`${b.value.name} template`:"Existing invitation"),l=v({invitation_template_id:null,bride_name:"",groom_name:"",date:"",time:"",venue_name:"",venue_address:"",dress_code:"",is_published:!1,user_id:null}),w=v([]),h=v(!1),$=async()=>{var a,e;if(!m.value||!u.id){x.value="Пользователя можно добавить только для уже созданного приглашения";return}try{_.value=!0,x.value=null;const o=(await I.post(`/api/invitations/${u.id}/create-user`)).data;o.user?(l.value.user_id=o.user.id,alert(`User created/attached: ${o.user.email}`)):o.message&&(x.value=o.message)}catch(s){x.value=((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"Ошибка при создании/привязке пользователя"}finally{_.value=!1}},A=async()=>{h.value=!0;try{const a=await fetch("/api/users");if(!a.ok)return;const e=await a.json();w.value=e}catch(a){console.error("Error loading users",a)}finally{h.value=!1}},y=v([{time:"18:00",label:"Welcome drink"},{time:"19:00",label:"Ceremony"},{time:"20:00",label:"Dinner & party"}]),k=v(!1),f=v(""),B=()=>{y.value.push({time:"",label:""})};M(async()=>{var a;await A();try{if(m.value&&u.id){const e=await fetch(`/api/invitations/${u.id}`);if(!e.ok)return[];const s=await e.json();b.value=s.template,l.value.invitation_template_id=s.invitation_template_id,l.value.bride_name=s.bride_name,l.value.groom_name=s.groom_name,l.value.date=s.date||"",l.value.time=s.time||"",l.value.venue_name=s.venue_name||"",l.value.venue_address=s.venue_address||"",l.value.dress_code=s.dress_code||"",l.value.is_published=!!s.is_published,l.value.user_id=s.user_id??null;const o=(a=s.data)==null?void 0:a.program;Array.isArray(o)&&o.length&&(y.value=o)}else if(!m.value&&u.templateKey){const e=await fetch(`/api/templates/${u.templateKey}`);if(!e.ok)throw new Error("Failed to load template");b.value=await e.json(),l.value.invitation_template_id=b.value.id}}catch(e){console.error(e),f.value=e.message||"Failed to load data"}});const D=async()=>{k.value=!0,f.value="";try{const a={...l.value,data:{program:y.value}};let e="/api/invitations",s="POST";m.value&&u.id&&(e=`/api/invitations/${u.id}`,s="PUT");const o=await fetch(e,{method:s,headers:{"X-CSRF-TOKEN":F,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(a)});if(!o.ok)throw new Error("Failed to save invitation");const g=await o.json();m.value?alert("Invitation updated!"):alert(`Invitation created! Public URL: ${window.location.origin}/i/${g.slug}`),j.push({name:"invitations.index"})}catch(a){f.value=a.message||"Error saving invitation"}finally{k.value=!1}};return(a,e)=>(i(),r("section",null,[t("h1",O,n(m.value?"Edit invitation":"Create invitation"),1),t("p",W,n(P.value),1),t("button",{type:"button",class:"btn-secondary text-xs",disabled:_.value||!m.value,onClick:$},n(_.value?"Creating user...":"Add user"),9,X),x.value?(i(),r("p",G,n(x.value),1)):c("",!0),t("div",H,[t("form",{class:"space-y-4",onSubmit:N(D,["prevent"])},[t("div",J,[w.value.length?(i(),r("div",z,[e[10]||(e[10]=t("label",{class:"block text-[11px] font-medium text-slate-600 mb-1"}," Кто может видеть статистику (владелец) ",-1)),d(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.user_id=s),class:"mt-1 block w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-leaf focus:ring-leaf"},[e[9]||(e[9]=t("option",{value:null}," Только супер-админ (не привязано к аккаунту) ",-1)),(i(!0),r(S,null,C(w.value,s=>(i(),r("option",{key:s.id,value:s.id},[E(n(s.name)+" ("+n(s.email)+") ",1),s.is_superadmin?(i(),r("span",Y,"— Superadmin")):c("",!0)],8,Q))),128))],512),[[R,l.value.user_id]])])):c("",!0),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-xs font-medium text-slate-700"},"Bride name",-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.bride_name=s),type:"text",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400",required:""},null,512),[[p,l.value.bride_name]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-xs font-medium text-slate-700"},"Groom name",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.groom_name=s),type:"text",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400",required:""},null,512),[[p,l.value.groom_name]])])]),t("div",Z,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-xs font-medium text-slate-700"},"Date",-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.date=s),type:"date",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[p,l.value.date]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-xs font-medium text-slate-700"},"Time",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.time=s),type:"text",placeholder:"18:00",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[p,l.value.time]])])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-xs font-medium text-slate-700"},"Venue name",-1)),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.venue_name=s),type:"text",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[p,l.value.venue_name]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-xs font-medium text-slate-700"},"Venue address",-1)),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.venue_address=s),type:"text",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[p,l.value.venue_address]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-xs font-medium text-slate-700"},"Dress code",-1)),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.dress_code=s),type:"text",placeholder:"Elegant / Festive",class:"mt-1 block w-full rounded-xl border-slate-200 text-sm shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,512),[[p,l.value.dress_code]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-xs font-medium text-slate-700 mb-1"},"Program",-1)),(i(!0),r(S,null,C(y.value,(s,o)=>(i(),r("div",{key:o,class:"mb-2 flex gap-2"},[d(t("input",{"onUpdate:modelValue":g=>s.time=g,type:"text",placeholder:"18:00",class:"block w-24 rounded-xl border-slate-200 text-xs shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,8,ee),[[p,s.time]]),d(t("input",{"onUpdate:modelValue":g=>s.label=g,type:"text",placeholder:"Welcome drink",class:"block flex-1 rounded-xl border-slate-200 text-xs shadow-sm focus:border-rose-400 focus:ring-rose-400"},null,8,te),[[p,s.label]])]))),128)),t("button",{type:"button",class:"btn-primary",onClick:B}," + Add program item ")]),t("div",se,[t("label",le,[d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.is_published=s),type:"checkbox",class:"rounded border-slate-300 text-rose-500 focus:ring-rose-400"},null,512),[[q,l.value.is_published]]),e[19]||(e[19]=t("span",null,"Publish invitation",-1))]),t("button",{type:"submit",class:"rounded-full bg-rose-500 px-4 py-1.5 text-xs font-medium text-white hover:bg-rose-600",disabled:k.value},n(k.value?"Saving...":m.value?"Save changes":"Create invitation"),9,ae)]),f.value?(i(),r("p",oe,n(f.value),1)):c("",!0)],32),t("div",ne,[e[21]||(e[21]=t("h2",{class:"mb-3 text-sm font-medium text-slate-700"},"Preview",-1)),t("div",re,[t("div",ie,[t("div",de,[e[20]||(e[20]=t("p",{class:"text-[10px] tracking-[0.35em] uppercase text-slate-400"}," Օնլայն հրավիրատոմս ",-1)),t("h1",ue,n(l.value.bride_name||"Bride")+" & "+n(l.value.groom_name||"Groom"),1),l.value.date||l.value.time?(i(),r("p",me,[E(n(l.value.date||"2025-11-16")+" ",1),l.value.time?(i(),r("span",ve," • "+n(l.value.time),1)):c("",!0)])):c("",!0),l.value.venue_name?(i(),r("p",pe,n(l.value.venue_name),1)):c("",!0)])])]),e[22]||(e[22]=t("p",{class:"mt-2 text-[11px] text-slate-500"}," Стиль превью будет зависеть от темы (Elegant, Nature, Luxury, Pastel). ",-1))])])]))}};export{be as default};
